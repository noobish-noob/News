<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My First News Site</title>
    <!-- Load Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind to use Inter font and apply rounded corners globally -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom scrollbar for desktop/tablet view */
        .headline-list::-webkit-scrollbar {
            width: 8px;
        }

        .headline-list::-webkit-scrollbar-thumb {
            background-color: #cbd5e1; /* slate-300 */
            border-radius: 20px;
        }

        .headline-list::-webkit-scrollbar-track {
            background: #f1f5f9; /* slate-100 */
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8 font-sans">

    <!-- Main Container -->
    <div class="max-w-4xl mx-auto">

        <!-- Header -->
        <header class="mb-8 p-4 bg-white shadow-xl rounded-xl">
            <h1 class="text-3xl font-bold text-gray-800 text-center">First News</h1>
            <p class="text-center text-sm text-gray-500 mt-1">Trending Headlines from around the world</p>
        </header>

        <!-- Tab Navigation (Updated GB to World) -->
        <nav class="flex justify-center mb-6 bg-white p-2 rounded-xl shadow-lg">
            <button id="tab-in" data-country="in"
                    class="tab-button w-1/3 py-3 text-sm font-semibold text-white rounded-lg transition-all duration-300 shadow-md bg-indigo-600 hover:bg-indigo-700 mx-1">
                üáÆüá≥ India
            </button>
            <button id="tab-us" data-country="us"
                    class="tab-button w-1/3 py-3 text-sm font-semibold text-gray-600 rounded-lg transition-all duration-300 hover:bg-indigo-50 hover:text-indigo-600 mx-1">
                üá∫üá∏ US
            </button>
            <button id="tab-world" data-country="world"
                    class="tab-button w-1/3 py-3 text-sm font-semibold text-gray-600 rounded-lg transition-all duration-300 hover:bg-indigo-50 hover:text-indigo-600 mx-1">
                üåç World
            </button>
        </nav>

        <!-- News Content aArea -->
        <div id="news-container" class="bg-white p-4 sm:p-6 rounded-xl shadow-2xl">
            <div id="headline-list" class="headline-list space-y-4 max-h-[70vh] overflow-y-auto">
                <!-- Headlines will be inserted here by JavaScript -->
                <p class="text-center text-gray-500 py-10">Loading trending headlines...</p>
            </div>

            <!-- Load More Container -->
            <div id="load-more-container" class="mt-4 text-center hidden">
                <button id="load-more-button"
                        class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150">
                    Load More
                </button>
            </div>

        </div>

        <!-- Footer / Data Source Information -->
        <footer class="mt-8 text-center text-xs text-gray-400">
            <p>Data provided by a third-party news API.</p>
        </footer>
    </div>

    <script>
        // --- HARDCODED API KEY ---
        const apiKey = 'pub_7f7d8e3f4a7a4c23a323542f32f27e94'; 

        // --- PAGINATION STATE & CONSTANTS ---
        const HEADLINES_PER_PAGE = 5;
        let appState = {
            currentArticles: [], // Stores all fetched articles for the active tab
            currentIndex: 0,     // Index of the next article to load
            countryCode: 'in'
        };
        // ------------------------------------

        // DOM elements
        const headlineList = document.getElementById('headline-list');
        const tabButtons = document.querySelectorAll('.tab-button');
        const loadMoreContainer = document.getElementById('load-more-container');
        const loadMoreButton = document.getElementById('load-more-button');

        // Utility function to display messages instead of alerts
        function displayMessage(message, type = 'info') {
            const color = type === 'error' ? 'text-red-600' : 'text-yellow-600';
            const bgColor = type === 'error' ? 'bg-red-50' : 'bg-yellow-50';

            headlineList.innerHTML = `
                <div class="text-center p-6 ${bgColor} rounded-xl">
                    <p class="font-semibold ${color}">${message}</p>
                </div>
            `;
            // Hide the load more button when an error or info message is displayed
            loadMoreContainer.classList.add('hidden');
        }

        // --- NEWS API LOGIC ---

        // Map for display names (Used in loading/error messages)
        const countryMap = {
            'in': 'India',
            'us': 'US',
            'world': 'World'
        };

        // New function to update the visibility of the Load More button
        function updateLoadMoreButton() {
            const remainingCount = appState.currentArticles.length - appState.currentIndex;
            if (remainingCount > 0) {
                loadMoreButton.textContent = `Load More`;
                loadMoreContainer.classList.remove('hidden');
            } else {
                loadMoreContainer.classList.add('hidden');
            }
        }

        async function fetchNews(countryCode) {
            let url = `https://newsdata.io/api/1/latest?apikey=${apiKey}&language=en`;

            if (countryCode !== 'world') {
                url += `&country=${countryCode}`;
            }

            headlineList.innerHTML = `
                <div class="flex justify-center items-center py-10">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="text-indigo-500 font-medium">Loading trending headlines for ${countryMap[countryCode]}...</p>
                </div>
            `;
            loadMoreContainer.classList.add('hidden'); // Hide button during load

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.status === 'error') {
                    let errorMessage = data.message || "An unknown Newsdata.io API error occurred.";
                    displayMessage(`API Error for ${countryMap[countryCode]}: ${errorMessage}`, 'error');
                    return;
                }
                
                // --- Update State after successful fetch ---
                appState.currentArticles = data.results || [];
                appState.currentIndex = 0;
                appState.countryCode = countryCode;
                
                renderHeadlines(true); // Start a new render (clears old list)

            } catch (error) {
                console.error("Fetch failed:", error);
                displayMessage(`Network error while fetching news for ${countryMap[countryCode]}.`, 'error');
            }
        }

        // Function to render news headlines (Updated for pagination)
        function renderHeadlines(isNewLoad = false) {
            const articles = appState.currentArticles;

            if (isNewLoad) {
                headlineList.innerHTML = ''; // Clear existing content only for a new tab load
                
                // Handle no results case immediately after fetch
                if (!articles || articles.length === 0) {
                    headlineList.innerHTML = `<p class="text-center text-gray-500 py-10">No trending news found for ${countryMap[appState.countryCode]} at this time.</p>`;
                    updateLoadMoreButton();
                    return;
                }
            }
            
            // Calculate slice window
            const startIndex = appState.currentIndex;
            const endIndex = Math.min(startIndex + HEADLINES_PER_PAGE, articles.length);

            // Get the articles for this page
            const articlesToRender = articles.slice(startIndex, endIndex);

            // Render the articles (appending to the list)
            articlesToRender.forEach(item => { 
                const newsItem = document.createElement('a');
                newsItem.href = item.link || '#';
                newsItem.target = "_blank";
                newsItem.className = 'block p-4 border border-gray-100 bg-white rounded-xl shadow-md transition-all duration-200 hover:shadow-lg hover:border-indigo-400 cursor-pointer';

                const headlineText = document.createElement('p');
                headlineText.className = 'text-base font-semibold text-gray-800 leading-relaxed mb-1';
                headlineText.textContent = item.title;

                const sourceText = document.createElement('p');
                sourceText.className = 'text-xs text-indigo-500 font-medium italic';
                sourceText.textContent = `Source: ${item.source_id || 'Unknown'}`;

                newsItem.appendChild(headlineText);
                newsItem.appendChild(sourceText);
                headlineList.appendChild(newsItem);
            });

            // Update index for next page load
            appState.currentIndex = endIndex;
            
            // Update button state
            updateLoadMoreButton();
        }

        // New function for handling 'Load More' click
        function loadMoreHeadlines() {
            renderHeadlines(false);
        }

        // Add event listener for the new button
        loadMoreButton.addEventListener('click', loadMoreHeadlines);

        // Function to handle tab clicks
        function switchRegion(event) {
            const selectedButton = event.currentTarget;
            const countryCode = selectedButton.getAttribute('data-country');

            // 1. Update button styles
            tabButtons.forEach(button => {
                button.classList.remove('bg-indigo-600', 'text-white', 'shadow-md');
                // Ensure only the selected button gets text-white for flag readability
                button.classList.add('text-gray-600', 'hover:bg-indigo-50', 'hover:text-indigo-600');
            });

            selectedButton.classList.add('bg-indigo-600', 'text-white', 'shadow-md');
            selectedButton.classList.remove('text-gray-600', 'hover:bg-indigo-50', 'hover:text-indigo-600');

            // 2. Fetch and render content
            fetchNews(countryCode);
        }

        // Add event listeners to all tab buttons
        tabButtons.forEach(button => {
            button.addEventListener('click', switchRegion);
        });

        // Initialize the app by setting the default tab state (India)
        function initializeTabState() {
            const indiaButton = document.getElementById('tab-in');
            if (indiaButton) {
                // Set the active style for the default tab
                indiaButton.classList.add('bg-indigo-600', 'text-white', 'shadow-md');
                indiaButton.classList.remove('text-gray-600', 'hover:bg-indigo-50', 'hover:text-indigo-600');
            }
            // Load news for the default tab
            fetchNews('in');
        }

        // Start initialization on window load
        window.onload = initializeTabState;
    </script>
</body>
</html>
